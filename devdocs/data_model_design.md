# Data Model Design

## Overview
This document describes the schema of the SQLite database generated by the IDA Pro export script (`export_binary_db.py`). The database stores static analysis results, including metadata, segments, functions, symbols, and cross-references.

## Schema Details

### 1. Metadata
Stores global information about the analyzed binary.
- `key` (TEXT, PK): The metadata key (e.g., 'sha256', 'file_name', 'processor').
- `value` (TEXT): The value associated with the key.

### 2. Segments
Represents memory segments defined in the binary.
- `seg_id` (INTEGER, PK): Auto-incrementing ID.
- `name` (TEXT): Segment name (e.g., '.text', '.data').
- `start_va` (INTEGER): Start virtual address.
- `end_va` (INTEGER): End virtual address.
- `perm_r`, `perm_w`, `perm_x` (INTEGER): Read, Write, Execute permissions (0 or 1).
- `file_offset` (INTEGER): Offset in the file (if applicable).
- `type` (TEXT): Segment type (CODE, DATA, BSS, EXTERN, etc.).

### 3. Sections
Represents sections, often mapping 1:1 with segments but with calculated entropy.
- `sec_id` (INTEGER, PK): Auto-incrementing ID.
- `name` (TEXT): Section name.
- `start_va` (INTEGER): Start virtual address.
- `end_va` (INTEGER): End virtual address.
- `file_offset` (INTEGER): File offset.
- `entropy` (REAL): Shannon entropy of the section content.
- `type` (TEXT): Section type.

### 4. Imports
External functions and data imported by the binary.
- `import_id` (INTEGER, PK): Auto-incrementing ID.
- `library` (TEXT): Name of the library (DLL/SO).
- `name` (TEXT): Name of the imported symbol.
- `ordinal` (INTEGER): Ordinal number.
- `address` (INTEGER): Virtual address of the import table entry.
- `thunk_address` (INTEGER): Address of the thunk function (if any).

### 5. Exports
Functions and data exported by the binary.
- `export_id` (INTEGER, PK): Auto-incrementing ID.
- `name` (TEXT): Exported name.
- `ordinal` (INTEGER): Ordinal number.
- `address` (INTEGER): Virtual address of the exported item.
- `forwarder` (TEXT): Forwarder string (if applicable).

### 6. Symbols
All named symbols in the binary (functions, data, labels).
- `symbol_id` (INTEGER, PK): Auto-incrementing ID.
- `name` (TEXT): Symbol name.
- `demangled_name` (TEXT): Demangled name (if applicable).
- `kind` (TEXT): Type of symbol (function, data, label).
- `address` (INTEGER): Virtual address.
- `size` (INTEGER): Size in bytes.

### 7. Functions
Disassembled functions.
- `function_va` (INTEGER, PK): Entry point address (Virtual Address).
- `name` (TEXT): Function name.
- `demangled_name` (TEXT): Demangled name.
- `start_va` (INTEGER): Start address.
- `end_va` (INTEGER): End address.
- `size` (INTEGER): Function size.
- `is_thunk` (INTEGER): 1 if thunk, 0 otherwise.
- `is_library` (INTEGER): 1 if library function, 0 otherwise.

### 8. Functions R-Tree (Virtual Table)
Spatial index for fast function lookup by address range.
- `function_va` (INTEGER): Foreign key to `functions`.
- `start_va` (INTEGER): Range start.
- `end_va` (INTEGER): Range end.

### 9. Pseudocode
Decompiled C-like pseudocode (requires Hex-Rays decompiler).
- `function_va` (INTEGER, PK): Function address.
- `content` (TEXT): Decompiled source code.

### 10. Disassembly Chunks
Raw disassembly text, chunked for efficient storage and retrieval.
- `start_va` (INTEGER, PK): Start address of the chunk.
- `end_va` (INTEGER): End address.
- `content` (TEXT): Disassembly text (multiple lines).

### 11. Data Items
Individual data items (bytes, words, strings, etc.) in the binary.
- `address` (INTEGER, PK): Virtual address.
- `size` (INTEGER): Size in bytes.
- `kind` (TEXT): Data kind (byte, dword, string, etc.).
- `type_name` (TEXT): C-type name.
- `repr` (TEXT): String representation/disassembly.
- `target_va` (INTEGER): Target address (for pointers/offsets).

### 12. Strings
Extracted string literals.
- `string_id` (INTEGER, PK): Auto-incrementing ID.
- `address` (INTEGER): Virtual address.
- `encoding` (TEXT): String encoding (e.g., ascii).
- `length` (INTEGER): Length in bytes.
- `string` (TEXT): The string content.
- `section_name` (TEXT): Name of the containing section.

### 13. Xrefs (Cross-References)
Code and data cross-references.
- `xref_id` (INTEGER, PK): Auto-incrementing ID.
- `from_va` (INTEGER): Source address.
- `to_va` (INTEGER): Destination address.
- `from_function_va` (INTEGER): Function containing the source address.
- `to_function_va` (INTEGER): Function containing the destination address.
- `xref_type` (TEXT): Type of xref (call, jmp, data_read, data_write, offset).
- `operand_index` (INTEGER): Operand index (0-based).

### 14. Call Edges
Function call graph edges.
- `caller_function_va` (INTEGER): Address of caller function.
- `callee_function_va` (INTEGER): Address of callee function.
- `call_site_va` (INTEGER): Address where the call happens.
- `call_type` (TEXT): Type of call (direct, etc.).
- PK: (`caller_function_va`, `call_site_va`)

### 15. Local Types
C-style type definitions (structs, enums) extracted from IDA.
- `type_id` (INTEGER, PK): Auto-incrementing ID.
- `name` (TEXT): Type name (or 'default' for bulk dump).
- `content` (TEXT): C definition content.

## Indexes
Indexes are created on key columns (names, addresses, ranges) to optimize query performance for common analysis tasks.
